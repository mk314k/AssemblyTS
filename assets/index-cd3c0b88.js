var T=Object.defineProperty;var A=(s,t,e)=>t in s?T(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var i=(s,t,e)=>(A(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const o of u.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerPolicy&&(u.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?u.credentials="include":r.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function n(r){if(r.ep)return;r.ep=!0;const u=e(r);fetch(r.href,u)}})();function E(s,t=5){let e=s.toString(2);return e.length<t&&(e="0".repeat(t-e.length)+e),e}class H{constructor(t){this.data=t}numValue(){return this.data}binaryRep(){return E(this.data,32)}hexRep(){return this.data.toString(16)}}class S{constructor(){i(this,"memory");this.memory=new Map}get(t){return this.memory.get(t)}set(t,e){this.memory.set(t,e)}outHTML(t){t&&(t.innerHTML="",this.memory.forEach((e,n)=>{const r=document.createElement("div");r.classList.add("mem-byte"),r.innerHTML=`${n}: ${e.hexRep()}`,t.appendChild(r)}))}}class g extends Error{constructor(){super("Invalid register index"),this.name="RegisterIndexError"}}class N extends Error{constructor(t){super(t),this.name="SyntaxError"}}const x={zero:"x0",ra:"x1",sp:"x2",gp:"x3",tp:"x4",t0:"x5",t1:"x6",t2:"x7",s0:"x8",s1:"x9",a0:"x10",a1:"x11",a2:"x12",a3:"x13",a4:"x14",a5:"x15",a6:"x16",a7:"x17",s2:"x18",s3:"x19",s4:"x20",s5:"x21",s6:"x22",s7:"x23",s8:"x24",s9:"x25",s10:"x26",s11:"x27",t3:"x28",t4:"x29",t5:"x30",t6:"x31"};function O(s){return/^x([0-9]|[1-2]\d|3[0-1])$/.test(s)||s in x}function B(s){if(typeof s=="number"){if(Number.isInteger(s)&&s>=0&&s<32)return s;throw new g}else{if(s in x)s=x[s];else if(!/^x([0-9]|[1-2]\d|3[0-1])$/.test(s))throw new g;return parseInt(s.slice(1))}}function y(s){return E(B(s),5)}function d(s){return typeof s=="number"?Number.isInteger(s)&&s>=0&&s<32:/^x([0-9]|[1-2]\d|3[0-1])$/.test(s)||s in x}class ${constructor(t=0){i(this,"val");this.val=t}jump(t){this.val=t}step(){this.val+=4}}class j{constructor(){i(this,"registers");this.registers=new Array(32).fill(0)}getValue(t){const e=B(t);return this.registers[e]}setValue(t,e){const n=B(t);this.registers[n]=e}outHTML(t){if(t){let e="";for(const n in x){let r=this.getValue(n).toString(16);r.length<8&&(r="0".repeat(8-r.length)+r),e+=`
            <div class="register flex-vertical">
              <span>${n}</span>
              <span>0x${r}</span>
              <span>${x[n]}</span>
            </div>
          `}t.innerHTML=e}}}class c{}i(c,"registers",new j),i(c,"instMemory",new S),i(c,"dataMemory",new S),i(c,"pc",new $);class w{constructor(t,e,n){i(this,"funct7","");i(this,"funct3","");i(this,"opcode","");i(this,"func",(t,e,n)=>{throw new Error("function not implemented")});this.reg1=t,this.reg2=e,this.reg_num=n}binaryRep(){return""}hexRep(){return this.numValue().toString(16)}numValue(){return parseInt(this.binaryRep(),2)}execute(){}}class m extends w{constructor(t,e,n){if(d(t)&&d(e)&&d(n))super(t,e,n);else throw new g;this.funct7="0000000",this.opcode="0110011"}binaryRep(){return this.funct7+y(this.reg_num)+y(this.reg2)+this.funct3+y(this.reg1)+this.opcode}execute(){c.registers.setValue(this.reg1,this.func(c.registers.getValue(this.reg2),c.registers.getValue(this.reg_num)))}}class a extends w{constructor(t,e,n){if(d(t)&&d(e))super(t,e,n);else throw new g;this.opcode="0010011"}binaryRep(){return E(this.reg_num)+y(this.reg2)+this.funct3+y(this.reg1)+this.opcode}execute(){c.registers.setValue(this.reg1,this.func(c.registers.getValue(this.reg2),this.reg_num))}}class R extends w{constructor(t,e,n){if(d(t)&&d(n))super(t,n,e);else throw new g;this.funct3="010"}}class p extends w{constructor(t,e,n){if(d(e)&&d(t))super(t,e,n);else throw new g}execute(){c.pc.jump(this.func(c.registers.getValue(this.reg1),c.registers.getValue(this.reg2),this.reg_num))}}class D extends R{execute(){const t=c.dataMemory.get(c.registers.getValue(this.reg2)+this.reg_num);c.registers.setValue(this.reg1,t.numValue())}}class P extends R{execute(){c.dataMemory.set(c.registers.getValue(this.reg2)+this.reg_num,new H(c.registers.getValue(this.reg1)))}}class q extends a{constructor(t,e){super(t,t,e)}execute(){c.registers.setValue(this.reg1,this.reg_num)}}class C extends a{constructor(t,e){super(t,t,e)}execute(){c.registers.setValue(this.reg1,this.reg_num)}}class X extends m{constructor(){super(...arguments);i(this,"funct3","000");i(this,"func",(e,n)=>e+n)}}class z extends m{constructor(){super(...arguments);i(this,"funct3","000");i(this,"funct7","0100000");i(this,"func",(e,n)=>e-n)}}class F extends m{constructor(){super(...arguments);i(this,"funct3","111");i(this,"func",(e,n)=>e&n)}}class K extends m{constructor(){super(...arguments);i(this,"funct3","110");i(this,"func",(e,n)=>e|n)}}class W extends m{constructor(){super(...arguments);i(this,"funct3","100");i(this,"func",(e,n)=>e^n)}}class G extends m{constructor(){super(...arguments);i(this,"funct3","001");i(this,"func",(e,n)=>e+n)}}class J extends m{constructor(){super(...arguments);i(this,"funct3","101");i(this,"func",(e,n)=>e+n)}}class Q extends m{constructor(){super(...arguments);i(this,"funct3","101");i(this,"funct7","0100000");i(this,"func",(e,n)=>e+n)}}class U extends a{constructor(){super(...arguments);i(this,"func",(e,n)=>e+n)}}class Y extends a{constructor(){super(...arguments);i(this,"func",(e,n)=>e&n)}}class Z extends a{constructor(){super(...arguments);i(this,"func",(e,n)=>e|n)}}class k extends a{constructor(){super(...arguments);i(this,"func",(e,n)=>e^n)}}class ee extends a{constructor(){super(...arguments);i(this,"func",(e,n)=>e+n)}}class te extends a{constructor(){super(...arguments);i(this,"func",(e,n)=>e+n)}}class se extends a{constructor(){super(...arguments);i(this,"func",(e,n)=>e+n)}}class ne extends a{constructor(){super(...arguments);i(this,"func",(e,n)=>e+n)}}class re extends a{constructor(){super(...arguments);i(this,"func",(e,n)=>e+n)}}class ie extends p{constructor(){super(...arguments);i(this,"func",(e,n,r)=>e==n?r:c.pc.val)}}class ce extends p{constructor(){super(...arguments);i(this,"func",(e,n,r)=>e==n?r:c.pc.val)}}class ue extends p{constructor(){super(...arguments);i(this,"func",(e,n,r)=>e==n?r:c.pc.val)}}class oe extends p{constructor(){super(...arguments);i(this,"func",(e,n,r)=>e==n?r:c.pc.val)}}class ae extends p{constructor(){super(...arguments);i(this,"func",(e,n,r)=>e==n?r:c.pc.val)}}class le extends p{constructor(){super(...arguments);i(this,"func",(e,n,r)=>e==n?r:c.pc.val)}}class de extends w{constructor(){super()}execute(){c.pc.jump(c.registers.getValue("ra")-4)}}const _=new Map([["add",X],["sub",z],["and",F],["or",K],["xor",W],["sll",G],["srl",J],["sra",Q],["addi",U],["andi",Y],["ori",Z],["xori",k],["slti",ee],["sltiu",te],["slli",se],["srli",ne],["srai",re],["beq",ie],["bne",ce],["blt",ue],["bge",oe],["bltu",ae],["bgeu",le],["lw",D],["sw",P],["li",q],["lui",C],["ret",de]]),L=new Map;function b(s){return s===void 0?"":(s=s.trim(),L.has(s)?L.get(s):O(s)?s:parseInt(s))}function fe(s,t=540,e){const n=s.split(`
`);let r=e;r===void 0&&(r=new Map);let u=t;L.clear();for(let o of n)if(o=o.trim(),o)if(o.endsWith(":"))L.set(o.slice(0,o.length-1),u);else{const l=o.split(","),f=l[0].split(" ");if(_.has(f[0])){const M=_.get(f[0]),v=b(f[1]);if(v){const h=b(l[1]);if(h){const I=b(l[2]);if(I){const V=new M(v,h,I);r.set(u,V)}else{const V=new M(v,h);r.set(u,V)}}else{const I=new M(v);r.set(u,I)}}else{const h=new M;r.set(u,h)}u=u+4}else throw new N(`${f[0]} is not a defined Assembly instruction`)}if(e===void 0)return r}function me(){const s=document.getElementById("registers"),t=document.getElementById("instruction-memory"),e=document.getElementById("data-memory");c.dataMemory.outHTML(e),c.registers.outHTML(s),c.instMemory.outHTML(t);function n(){const o=document.getElementById("code").value,l=document.getElementById("buildAddr");let f=parseInt(l.value);isNaN(f)&&(f=540),fe(o,f,c.instMemory),c.instMemory.outHTML(t)}function r(){const u=document.getElementById("runAddr");let o=parseInt(u.value);for(isNaN(o)&&(o=540),c.pc.jump(o);c.pc.val!==0;)c.instMemory.get(c.pc.val).execute(),c.pc.step();c.dataMemory.outHTML(e),c.registers.outHTML(s)}if(s!==null&&t!==null&&e){const u=document.getElementById("buildRun"),o=document.getElementById("build"),l=document.getElementById("run");u==null||u.addEventListener("click",()=>{n(),r()}),o==null||o.addEventListener("click",()=>{n()}),l==null||l.addEventListener("click",()=>{r()})}}document.addEventListener("DOMContentLoaded",me);
